*********
SELF
*********
* Learn about localforage
--- Mostly done
* Learn about javascript promises
--- Done: I have read about it, know what it is

************************************************************************
Process for doing randomization frontend to backend and back to frontend
************************************************************************
aka There and Back Again
1.  x User selects base ROM, MD5 is checked
2.  x Base ROM is stored in localforage
2.5 x User selects options
3.  x Options & Base ROM get sent to backend via POST request
4.  x Backend does the randomization, outputs a file
5.  x Randomized file gets uploaded / sent back to frontend 
6.  x User gets option to save file


************
* FRONTEND *
************
BUGS

TODO
- Show feedback that something is happening when seed is being generated
-- like, a little text or animation, "generating..." 
- A way to share seeds via a link or similar (use database?)

**************
* RANDOMIZER *
**************
     BUGS
BUG: FIXED? in enemies-randomize-pools Bowser can get randomized to something else!
BUG: Enemy at the end of 8-2 (on the stairs before flag) should never be a firebar
BUG: Set Y pos of Lakitu to correct value (-> enemy algorithm rework)
BUG: No level shuffle + remove pipe transitions doesn't work together.
BUG: Toad turned into hammer bro in 8-4 can actually walk over and kill mario! you still win though, so.

      TODO
  ENEMIES 
  - algorithm needs big rework
  - idea: enemy groups?
  TODO: FIX Enemies stuck inside terrain!!!!!!!!!!!! IMPORTANT!!!!!
  ....... MAYBE JUST NOT RANDOMIZE PIRANHA PLANTS!?! that's probably the solution!
  TODO: Change/randomize y pos of (some) enemies? to prevent stuck enemies
  TODO: Shuffle enemies? or keep the randomization as it is now?
  TODO: Disappearing enemies/objects
        (goes for enemies and objects) "The level format is divided into "pages", so that only a small amount
        of level data is in RAM at any given time. The new page flag bit tells the game
        that the object it is set on is the first object in the page. Then, every object after that will
        appear on the same page until a new page bit is found. However,
        there are limits to this. If 3 objects are on the same x position for the same
        page, every object following that will not show up."
  TODO: Randomize enemies in pools better! from-/to-pools
  TODO: Disasm line  8370: fire bar spin speed / direction -- can be randomized!?
  TODO: Disasm line  8405: cheep cheep data -- can be randomized!?
  TODO: Disasm line  8698: enemy frenzy thing that checks for world 2 - should be changed??
  TODO: Disasm line 11440: it's possible/easy(?) to change which enemies can be stomped and not!
  RARE: Sometimes enemies "hide" behind scenery?
  TODO: Enemy Frenzy mode - guaranteed many more fire/bullet/cheep cheeps (generators)!!!!!
  spiny in enemy pools - if possible

TODO: Shuffle underground bonus + keep pipe transitions crashes the randomizer! Don't know why.
----- So maybe we remove the option to keep pipe transitions? And just remove them completely.


TODO: easy/hard warp zone gamble - easy = 2 good 1 bad - hard = 1 good 2 bad pipes
TODO: Option to disable beating Bowser by removing the bridge under him? So that you must shoot Bowser with fireballs.....
----- Can lead to softlocks, will need to guarantee powerups in the castles.
STARTED TODO: Better handling of seed flags
 - DONE: better algorithm, taken from Fred
 - we need a way to convert flag -> config options
 - we need a way to show flags in UI, changing when user changes settings
 - fun: enter VANILLA to get vanilla game?
 - maybe figure out better algorithm
 - currently, 12 letters, vanilla could be: vanillamario
 -- and then we change those based on chosen settings?
TODO: Option to enable hard mode from the start? If so, can we also disable world select mode?
TODO: inverted controls??
TODO: randomized levels?? As in, not shuffled, but random! levels can appear multiple times!? nah......
TODO: deceptive enemies? e.g. change graphics of enemies! (13555 in disasm, starts at offset 0x674e)
TODO: randomly add swimming to levels?? investigate how swimming levels work!
TODO: UNUSED BYTES: lines 4350, 11058, 15044 in disasm! (also that flagball thing)
TODO: Option to leave 8-4 un-randomized (enemies, items)
IDEA: Is it possible to change how high Bowser jumps? to make it more difficult to just run under him. maybe around disasm line 10239
TODO: DONE FOR UNDERGROUND BONUS AREA - Randomize where pipes lead to?
      -- option to include 4-2 warp zone or not in shuffle - if possible.
      -- also include cloud/water areas
TODO: Shuffle which pipes can be entered?
TODO: Randomize Fake Bowser identities!? possible? yes, SEE LINE 11121 IN DISASM!!
TODO: Option to randomize music? (line 2790 in disasm)
      -- ROM offset 0x10f7 - 0x10fc - star power music = line 11254 in disasm
TODO: Option to disable fireworks completely? (just set all to zero)
TODO: Randomize fireworks X,Y (line 8632 in disasm)
TODO: Shuffle all coins/powerups in vanilla in one big pool, so that you in total get the same number of coins/powerups, but don't know where they are
TODO: Disappearing trampolines
TODO: Disappearing powerup blocks sometimes - might be related to stuff around line 5860 in disasm
TODO: Option to not randomize texts
TODO: Keep randomized texts independent of game seed? or make it an option?
TODO: Option to keep castles in vanilla order? why? just because we can?
TODO: No level shuffle + remove pipe transitions combo does not remove pipe transitions. can be fixed.
TODO: Check that all options are set to a valid value!
TODO: Disasm line  1084: change demo action data in order to not spoil first level??  offset 0x350 in rom, length 20 bytes
TODO: Disasm line  7338: maybe a better way to shuffle powerups? for mode that changes all powerups of one type to another.
TODO: Disasm line  7787: respawn points - I think. look at that
TODO: Disasm line  8549: randomize fire Y positions?
TODO: A way to let individual options not change other aspects of randomization?!
      So that if you e.g. generate a new rom with the same seed, but enemy randomization turned off, all other aspects should be the same as before.
      Might be done by creating individual seeds for each aspect at the start of the program.


SHUFFLING ALL BONUS AREAS:
- pipe to 4-2 warp zone works
- vine going to underground bonus area works with:
  - page 2, 4, 6 and 8
- vine does NOT work with UBA page 0 (unless we figure out how to change x coord for where the vine appears)
- under water area works with pipes
- vine -> under water area does not work!
- vine to other cloud areas works




NOT HAPPENING SOON:
IDEA: use the SMB + Duck Hunt ROM for easy access to lots more PRG ROM!!! for custom code injection! 
needs:
  offset 0x6 = 21 (change mirroring, don't know why, but it works)
  to skip smn/dh selection menu:
    change bytes 0x11 - 0x18 to plain SMB: d8 a9 10 8d 00 20 a2 ff

  alternative route with plain rom: build our own 80kb ROM with the correct bytes here and there! (e.g. the header)
  that would leave a lot of room for activities.
  so, minus header:
  0x00000 - 0x07FFF = PRG ROM
  0x08000 - 0x0FFFF = ROOM FOR ACTIVITIES - 0x8000 bytes = 32768 bytes
  0x10000 - 0x11FFF = CHR ROM
  0x12000 - 0x14000 = EMPTY SPACE (probably needed so emulators don't freak out?)

  We could use this to write code to allow warp zones to be in any world?!

*********************************************************
DISCARDED IDEAS (AT LEAST FOR NOW)
*********************************************************
TODO: Deceptive warp pipes? Possible? Will need changing code. 
TODO: Technically, could we warp to a level that is NOT level 1 of a world?
      - No, not without code changes/additions
TODO: Shuffle scenery? nah... or?
TODO: Disasm line 13475: it's possible/easy(?) to change the appearance of a powerup!!!    NOPE DOESN'T WORK (sprites get weird)

*********************************************************
PROBABLY DONE
*********************************************************
99% SURE IS FIXED: fix warp zones! warp zone pipes have strange behavior (pipes with no number take you to world -1)
      not sure if anything can be done about this, except maybe keep levels with warp zones in their vanilla world?!
      see line 1682 in disasm

*********************************************************
DONE
*********************************************************
DONE - only power ups are random (flower, star, 1 up)
DONE - add coins to that pool
DONE: Randomize Bowser's abilities? like hammers etc.?
      - we could change the code which selects bowser's abilities based on which world you're in
DONE: Randomize Bowser's hitpoints? For when you kill him with fire.
DONE: change x pos of Toad/substitute Toad? To prevent Mario getting hit by a hammer bro or something after defeating Bowser.
DONE: Option to randomize number of starting lives.
DONE: hidden warp pipe destinations
      disasm line 1759: replace routine with NOP should work? YES!
      ROM offset: 0x892 length 22 bytes
DONE: Option to only randomize world order, but leave levels normal - e.g. the first world can be vanilla world 3,
     containing vanilla 3-1, 3-2, 3-3, 3-4, second world can be vanilla world 5, with levels 5-1 - 5-4, etc.
DONE: Warp zone gamble mode where you don't know where warp pipes lead - but 1 or 2 pipes are guaranteed to be good! yeah!
DONE: Useful warp zone shuffle option (all pipes take you to a higher world number)
DONE: Randomize when fireworks appear? (line 10469 of disasm)
DONE: Spoiler free generation (don't write a log file at all, or write one and set permissions to g-r group minus read ?)
      - for now we don't write a log at all.
DONE: Option to only randomize clothes for mario/luigi, for more reasonable colors, hopefully.

FIXED: shuffle levels with normal world order = infinite loop now (after adding 8-4 to sanity checks)
FIXED: 6-2 vine to cloud area goes to underwater area (at least in seed 6754485723-MNCLNESTQVEY )
FIXED: Pipe pointers not always correct! See smb-rando-2829311682-MNCLNESGQVE 







offset = 0x9fd6  (overwrites "2 PLAYER GAME")

